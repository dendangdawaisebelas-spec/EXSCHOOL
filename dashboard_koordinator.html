<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Koordinator ICMS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: 'Times New Roman', Times, serif; margin: 0; background: #f0f2f5; padding-bottom: 50px; }
        header { background: #0a1f44; color: white; padding: 25px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .container { padding: 20px; max-width: 1200px; margin: auto; }
        
        /* Tombol Utama */
        .btn-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px; }
        .btn-main { border: none; padding: 18px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 15px; color: white; transition: 0.3s; }
        .btn-rab { background: #1c7c54; }
        .btn-lap { background: #0a1f44; }
        .btn-mail { background: #db4437; }
        .btn-main:hover { opacity: 0.9; transform: translateY(-2px); }

        /* Grid Ekskul */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-top: 6px solid #0a1f44; }
        .status-ready { color: #2e7d32; font-weight: bold; }
        .status-wait { color: #c62828; font-weight: bold; }
        
        hr { border: 0; border-top: 1px solid #eee; margin: 15px 0; }
    </style>
</head>
<body>

<header>
    <h1>Pusat Komando Koordinator ICMS</h1>
    <p>Pembina: Ditya Manggala, S.Sn | pembinaekstrakurikulerkeren@gmail.com</p>
</header>

<div class="container">
    <div class="btn-group">
        <button class="btn-main btn-rab" onclick="cetakRAB()">ðŸ“¥ DOWNLOAD RAB HONOR PELATIH</button>
        <button class="btn-main btn-lap" onclick="cetakLaporanBulanan()">ðŸ“˜ DOWNLOAD LAPORAN BULANAN FORMAL</button>
        <button class="btn-main btn-mail" onclick="kirimNotifEmail()">ðŸ“§ KIRIM REKAP KE GMAIL PEMBINA</button>
    </div>

    <h2 style="color:#0a1f44; border-bottom: 2px solid #0a1f44; padding-bottom: 10px;">Monitoring Realisasi Ekskul</h2>
    
    <div class="grid" id="gridEkskul">
        </div>
</div>

<script>
    const { jsPDF } = window.jspdf;

    // Database Tarif (Sesuai Dokumen RAB ICMS)
    const tarifEkskul = { 
        "Panahan": 300000, "Futsal": 250000, "Dokter Kecil": 100000, 
        "Badminton": 150000, "Basket": 250000, "Renang": 150000, 
        "Pramuka": 160000, "Musik": 500000, "Taekwondo": 0,
        "Nihonggo Club": 0, "English Club": 0 
    };

    const daftarEkskul = Object.keys(tarifEkskul);

    function muatDashboard() {
        const grid = document.getElementById("gridEkskul");
        grid.innerHTML = "";

        daftarEkskul.forEach(nama => {
            const absen = JSON.parse(localStorage.getItem("data_" + nama)) || [];
            const eval = JSON.parse(localStorage.getItem("eval_" + nama)) || null;
            
            // Kalkulasi Honor
            let totalHonor = (nama === "Musik") ? 500000 : (nama === "Taekwondo" ? (parseInt(localStorage.getItem("t_Taek")) || 0) : absen.length * tarifEkskul[nama]);

            grid.innerHTML += `
                <div class="card">
                    <h3 style="margin:0;">${nama}</h3>
                    <p>Realisasi Pertemuan: <b>${absen.length} Kali</b></p>
                    <p>Estimasi Honor: <b>Rp ${totalHonor.toLocaleString('id-ID')}</b></p>
                    <hr>
                    <p>Status Evaluasi Bulanan: 
                        ${eval ? '<span class="status-ready">âœ“ SIAP CETAK (3 FOTO ADA)</span>' : '<span class="status-wait">âœ— BELUM DIISI</span>'}
                    </p>
                </div>
            `;
        });
    }

    // FUNGSI 1: CETAK RAB PDF
    function cetakRAB() {
        const doc = new jsPDF();
        doc.setFontSize(16); doc.text("RENCANA ANGGARAN BIAYA (RAB) HONOR PELATIH", 105, 15, {align:"center"});
        doc.setFontSize(12); doc.text("SMP - SMA INSAN CENDEKIA MAGNET SCHOOL", 105, 22, {align:"center"});

        let rows = []; let grandTotal = 0;
        daftarEkskul.forEach((nama, i) => {
            let absen = JSON.parse(localStorage.getItem("data_" + nama)) || [];
            let sub = (nama === "Musik") ? 500000 : (nama === "Taekwondo" ? parseInt(localStorage.getItem("t_Taek")) || 0 : absen.length * tarifEkskul[nama]);
            grandTotal += sub;
            rows.push([i+1, nama, "Rp " + tarifEkskul[nama].toLocaleString(), absen.length, "Rp " + sub.toLocaleString()]);
        });

        doc.autoTable({
            startY: 30,
            head: [['No', 'Ekstrakurikuler', 'Tarif', 'Vol', 'Total']],
            body: rows,
            foot: [['', '', '', 'TOTAL', "Rp " + grandTotal.toLocaleString()]]
        });

        const y = doc.lastAutoTable.finalY + 20;
        doc.text("Bogor, 25 November 2025", 140, y);
        doc.text("Koordinator Ekskul,", 140, y + 7);
        doc.text("( Ditya Manggala,
