<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pusat Koordinator ICMS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial; margin: 0; background: #f0f2f5; padding-bottom: 50px; }
        header { background: #0a1f44; color: white; padding: 20px; text-align: center; }
        .container { padding: 20px; max-width: 1200px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 5px solid #0a1f44; }
        .badge { font-size: 11px; padding: 4px 8px; border-radius: 20px; text-transform: uppercase; font-weight: bold; float: right; }
        .clear { background: #d4edda; color: #155724; } .pending { background: #fff3cd; color: #856404; }
        .btn-rab { background: #1c7c54; color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; margin-bottom: 20px; }
        .btn-act { flex: 1; padding: 10px; border-radius: 6px; cursor: pointer; font-size: 11px; border: 1px solid #ddd; font-weight: bold; }
        .logout { background: #ff4d4d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; float: right; margin-top: -55px; }
    </style>
</head>
<body>
<header><h1>Dashboard Koordinator</h1><p>Insan Cendekia Magnet School</p></header>
<div class="container">
    <button class="logout" onclick="localStorage.clear(); location.replace('index.html')">Logout</button>
    <button class="btn-rab" onclick="cetakRAB()">ðŸ“„ DOWNLOAD RAB (NOVEMBER 2025)</button>
    <div class="grid" id="grid"></div>
</div>
<script>
    const { jsPDF } = window.jspdf;
    const ekskuls = ["Panahan", "Futsal", "Dokter Kecil", "Badminton", "Basket", "Renang", "Pramuka", "Musik", "Taekwondo", "Nihonggo Club", "English Club"];
    
    function render() {
        const g = document.getElementById("grid"); g.innerHTML = "";
        ekskuls.forEach(n => {
            const d = JSON.parse(localStorage.getItem("data_" + n)) || [];
            const s = JSON.parse(localStorage.getItem("siswa_" + n)) || [];
            const t = localStorage.getItem("tarif_" + n) || 0;
            const a = localStorage.getItem("alasan_" + n) || "";
            let isClear = (d.length >= 3); if(n === "Musik") isClear = (d.length >= 4 || a !== "");
            
            g.innerHTML += `<div class="card">
                <span class="badge ${isClear ? 'clear':'pending'}">${isClear ? 'Clear':'Proses'}</span>
                <div style="font-weight:bold; color:#0a1f44;">${n}</div>
                <div style="font-size:13px; color:#666; margin-top:10px;">
                    <p>Pertemuan: ${d.length} | Siswa: ${s.length}</p>
                    <p>Honor: <b>Rp ${(n === "Musik" ? 500000 : d.length * t).toLocaleString()}</b></p>
                </div>
                <div style="display:flex; gap:5px; margin-top:10px;">
                    <button class="btn-act" onclick="setTarif('${n}')">ðŸ’° TARIF</button>
                    <button class="btn-act" onclick="setSiswa('${n}')">ðŸ‘¤ SISWA</button>
                    <button class="btn-act" onclick="alert('Laporan ${n}: '+JSON.stringify(d))">ðŸ“‹ DATA</button>
                </div>
            </div>`;
        });
    }

    function setTarif(n) { const t = prompt(`Set Tarif ${n}:`, 0); if(t) { localStorage.setItem("tarif_"+n, t); render(); } }
    function setSiswa(n) { const s = prompt(`Input Nama Siswa ${n} (pisahkan koma):`, ""); if(s) { localStorage.setItem("siswa_"+n, JSON.stringify(s.split(",").map(x => x.trim()))); render(); } }

    function cetakRAB() {
        const doc = new jsPDF(); 
        doc.setFontSize(14); doc.text("RENCANA ANGGARAN BIAYA - ICMS", 105, 20, {align:"center"});
        doc.setFontSize(10); doc.text("Jl. Tangkil No.123, Caringin, Bogor", 105, 26, {align:"center"});
        doc.line(20, 30, 190, 30);
        let rows = []; let total = 0;
        ekskuls.forEach((n, i) => {
            const d = JSON.parse(localStorage.getItem("data_"+n))||[];
            const t = parseInt(localStorage.getItem("tarif_"+n))||0;
            let sub = (n === "Musik") ? 500000 : d.length * t; total += sub;
            rows.push([i+1, n, d.length, "Rp "+sub.toLocaleString()]);
        });
        doc.autoTable({ startY: 40, head: [['No','Ekskul','Pertemuan','Insentif']], body: rows });
        const finalY = doc.lastAutoTable.finalY + 10;
        doc.text("TOTAL: Rp "+total.toLocaleString(), 140, finalY);
        const aMus = localStorage.getItem("alasan_Musik") || "";
        if(aMus) doc.text("Note Musik: "+aMus, 20, finalY + 10);
        doc.text("Koordinator: Ditya Manggala, S.Sn.", 130, finalY + 30);
        doc.save("RAB_ICMS_NOVEMBER_2025.pdf");
    }
    render();
</script>
</body>
</html>
