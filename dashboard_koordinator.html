<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koordinator ICMS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: 'Times New Roman', Times, serif; margin: 0; background: #f0f2f5; padding-bottom: 50px; }
        header { background: #0a1f44; color: white; padding: 20px; text-align: center; }
        .container { padding: 20px; max-width: 1100px; margin: auto; }
        .btn-main { background: #1c7c54; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .card { background: white; border-radius: 10px; padding: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-top: 5px solid #0a1f44; }
    </style>
</head>
<body>
<header><h1>Dashboard Koordinator ICMS</h1></header>
<div class="container">
    <button class="btn-main" onclick="cetakRAB()">ðŸ“¥ DOWNLOAD RAB HONOR</button>
    <button class="btn-main" style="background:#0a1f44" onclick="cetakLaporanBulanan()">ðŸ“˜ DOWNLOAD LAPORAN BULANAN</button>
    <div class="grid" id="gridE"></div>
</div>

<script>
    const { jsPDF } = window.jspdf;
    const tData = { "Panahan": 300000, "Futsal": 250000, "Dokter Kecil": 100000, "Badminton": 150000, "Basket": 250000, "Renang": 150000, "Pramuka": 160000, "Musik": 500000, "Taekwondo": 0 };
    const ekskuls = Object.keys(tData);

    function render() {
        const g = document.getElementById("gridE"); g.innerHTML = "";
        ekskuls.forEach(n => {
            const d = JSON.parse(localStorage.getItem("data_" + n)) || [];
            const ev = JSON.parse(localStorage.getItem("eval_" + n)) || null;
            let sub = (n === "Musik") ? 500000 : (n === "Taekwondo" ? (parseInt(localStorage.getItem("t_Taek")) || 0) : d.length * tData[n]);
            g.innerHTML += `<div class="card">
                <b>${n}</b><br><small>Pertemuan: ${d.length}</small><br>
                Sub-Total: <b>Rp ${sub.toLocaleString()}</b><br>
                Laporan: ${ev ? '<span style="color:green">Ada</span>' : '<span style="color:red">Belum</span>'}
            </div>`;
        });
    }

    function cetakRAB() {
        const doc = new jsPDF();
        doc.setFontSize(14); doc.text("RENCANA ANGGARAN BIAYA - ICMS", 105, 15, {align:"center"});
        let rows = []; let tot = 0;
        ekskuls.forEach((n, i) => {
            let d = JSON.parse(localStorage.getItem("data_"+n))||[];
            let sub = (n === "Musik") ? 500000 : (n === "Taekwondo" ? parseInt(localStorage.getItem("t_Taek"))||0 : d.length * tData[n]);
            tot += sub; rows.push([i+1, n, tData[n].toLocaleString(), d.length, "Rp "+sub.toLocaleString()]);
        });
        doc.autoTable({ startY: 25, head: [['No','Ekskul','Satuan','Vol','Total']], body: rows });
        doc.text("Bogor, 29 Nov 2025", 140, doc.lastAutoTable.finalY + 15);
        doc.text("( Ditya Manggala, S.Sn )", 140, doc.lastAutoTable.finalY + 35);
        doc.save("RAB_ICMS.pdf");
    }

    function cetakLaporanBulanan() {
        const doc = new jsPDF();
        doc.setFont("times", "bold"); doc.text("LAPORAN BULANAN PEMBINA EKSKUL", 105, 40, {align:"center"});
        doc.setFontSize(12); doc.text("Ditya Manggala, S.Sn", 105, 50, {align:"center"});
        
        ekskuls.forEach(n => {
            const ev = JSON.parse(localStorage.getItem("eval_" + n));
            if(ev) {
                doc.addPage();
                doc.text("LAPORAN: " + n, 20, 20);
                doc.setFont("times", "normal");
                doc.text("Kendala: " + ev.kendala, 20, 35);
                if(ev.fotos) {
                    doc.addImage(ev.fotos[0], 'JPEG', 20, 50, 80, 50);
                    doc.addImage(ev.fotos[1], 'JPEG', 110, 50, 80, 50);
                    doc.addImage(ev.fotos[2], 'JPEG', 20, 110, 80, 50);
                }
            }
        });
        doc.save("Laporan_Lengkap.pdf");
    }
    render();
</script>
</body>
</html>
