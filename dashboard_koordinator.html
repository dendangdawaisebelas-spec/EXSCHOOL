<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koordinator ICMS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial; margin: 0; background: #f0f2f5; padding-bottom: 50px; }
        header { background: #0a1f44; color: white; padding: 20px; text-align: center; }
        .container { padding: 20px; max-width: 1200px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 5px solid #0a1f44; }
        .btn-main { background: #1c7c54; color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        .btn-act { flex: 1; padding: 10px; border-radius: 6px; cursor: pointer; font-size: 11px; border: 1px solid #ddd; font-weight: bold; }
    </style>
</head>
<body>
<header><h1>Dashboard Koordinator ICMS</h1></header>
<div class="container">
    <button class="btn-main" onclick="cetakRAB()">ðŸ“¥ CETAK RAB (RENCANA ANGGARAN BIAYA)</button>
    <button class="btn-main" style="background: #0a1f44;" onclick="cetakLaporanBulanan()">ðŸ“˜ CETAK LAPORAN BULANAN FORMAL</button>
    <button class="btn-main" style="background: #8e44ad;" onclick="bukaJadwalKaldik()">ðŸ“… JADWAL EKSKUL & KALDIK</button>
    <div class="grid" id="grid"></div>
</div>

<script>
    const { jsPDF } = window.jspdf;
    const tData = { "Panahan": 300000, "Futsal": 250000, "Dokter Kecil": 100000, "Badminton": 150000, "Basket": 250000, "Renang": 150000, "Pramuka": 160000, "Musik": 500000, "Taekwondo": 0, "Nihonggo Club": 0, "English Club": 0 };
    const ekskuls = Object.keys(tData);

    function render() {
        const g = document.getElementById("grid"); g.innerHTML = "";
        ekskuls.forEach(n => {
            const d = JSON.parse(localStorage.getItem("data_" + n)) || [];
            const s = JSON.parse(localStorage.getItem("siswa_" + n)) || [];
            const a = localStorage.getItem("alasan_" + n) || "";
            let hon = (n === "Musik") ? 500000 : (n === "Taekwondo" ? (parseInt(localStorage.getItem("t_Taek")) || 0) : d.length * tData[n]);
            let isCl = (d.length >= 3); if(n === "Musik") isCl = (d.length >= 4 || a !== "");

            g.innerHTML += `<div class="card">
                <span style="float:right; color:${isCl?'green':'orange'}">${isCl?'Clear':'Proses'}</span>
                <div style="font-weight:bold;">${n}</div>
                <div style="font-size:13px; margin:10px 0;">
                    Pertemuan: ${d.length} | Siswa: ${s.length}<br>Honor: <b>Rp ${hon.toLocaleString()}</b>
                    ${a ? `<br><i style="color:red">Alasan: ${a}</i>` : ''}
                </div>
                <div style="display:flex; gap:5px;">
                    ${n === "Taekwondo" ? `<button class="btn-act" onclick="setTaek()">ðŸ’° INVOICE</button>` : ''}
                    <button class="btn-act" onclick="setSiswa('${n}')">ðŸ‘¤ SISWA</button>
                    <button class="btn-act" onclick="alert(JSON.stringify(d))">ðŸ“‹ DATA</button>
                </div>
            </div>`;
        });
    }

    function setTaek() { let t = prompt("Total Invoice:"); if(t) { localStorage.setItem("t_Taek", t); render(); } }
    function setSiswa(n) { let s = prompt("Nama Siswa (koma):"); if(s) { localStorage.setItem("siswa_"+n, JSON.stringify(s.split(",").map(x=>x.trim()))); render(); } }

    function cetakRAB() {
        const doc = new jsPDF(); doc.text("RENCANA ANGGARAN BIAYA - ICMS", 105, 20, {align:"center"});
        let rows = []; let tot = 0;
        ekskuls.forEach((n, i) => {
            let d = JSON.parse(localStorage.getItem("data_"+n))||[];
            let sub = (n === "Musik") ? 500000 : (n === "Taekwondo" ? parseInt(localStorage.getItem("t_Taek"))||0 : d.length * tData[n]);
            tot += sub; rows.push([i+1, n, d.length, "Rp "+sub.toLocaleString()]);
        });
        doc.autoTable({ startY: 30, head: [['No','Ekskul','Pertemuan','Insentif']], body: rows });
        doc.text("TOTAL: Rp "+tot.toLocaleString(), 140, doc.lastAutoTable.finalY + 10);
        doc.save("RAB_ICMS.pdf");
    }

    function cetakLaporanBulanan() {
        const doc = new jsPDF(); doc.setFontSize(16); doc.text("LAPORAN BULANAN PEMBINA", 105, 80, {align:"center"});
        doc.addPage(); doc.setFontSize(12); doc.text("BAB I: PENDAHULUAN", 20, 20);
        doc.text("Laporan pertanggungjawaban program kerja bulanan ICMS...", 20, 30);
        doc.save("Laporan_Bulanan.pdf");
    }

    function bukaJadwalKaldik() {
      const modal = document.createElement("div");
      modal.style.cssText = "position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:9999; display:flex; justify-content:center; align-items:center; padding:20px;";
      modal.innerHTML = `<div style="background:white; padding:20px; border-radius:12px; max-width:600px; position:relative;">
        <button onclick="this.parentElement.parentElement.remove()" style="position:absolute; right:10px; top:10px; border:none; background:none; font-size:24px;">&times;</button>
        <img src="jadwal_ekskul.jpeg" style="width:100%; border-radius:8px; margin-bottom:15px;">
        <p>â€¢ 21 Juli: KBM<br>â€¢ 28-30 Nov: Perpulangan</p>
      </div>`;
      document.body.appendChild(modal);
    }
    render();
</script>
</body>
</html>
